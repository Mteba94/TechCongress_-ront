<!-- Paso Email -->
@if (currentStep() === 'email') {
    <div class="space-y-6">
        <div class="text-center">
            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <lucide-icon [img]="icons.mail" [size]="32" class="text-primary"></lucide-icon>
            </div>
            <h2 class="text-2xl font-heading font-bold text-foreground mb-2">
                Recuperar Contraseña
            </h2>
            <p class="text-muted-foreground">
                Ingresa tu correo electrónico y te enviaremos un código de verificación
            </p>
        </div>
        <form (ngSubmit)="handleEmailSubmit()" class="space-y-4">
            <app-input
                label="Correo Electrónico"
                type="email"
                name="email"
                placeholder="tu@correo.com"
                [value]="formData().email"
                (valueChange)="handleInputChange('email', $event)"
                [error]="errors()['email']"
                [required]="true"
            ></app-input>
            <div class="mt-4">
                <app-button
                    type="submit"
                    variant="default"
                    [loading]="isLoading()"
                    iconName="Send"
                    iconPosition="left"
                    [iconSize]="18"
                    [fullWidth]="true"
                >
                    <span>{{isLoading() ? 'Enviando código...' : 'Enviar Código'}}</span>
                </app-button>
            </div>
            <app-button
                type="button"
                variant="ghost"
                (click)="onBack.emit()"
                iconName="ArrowLeft"
                iconPosition="left"
                [iconSize]="16"
                [fullWidth]="true"
            >
                <span>Volver al inicio de sesión</span>
            </app-button>
        </form>
    </div>
}

<!-- Paso Código -->
@if (currentStep() === 'code') {
  <!-- <div class="space-y-6">
    <div class="text-center">
        <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <lucide-icon [img]="icons.shield" [size]="32" class="text-primary"></lucide-icon>
        </div>
        <h2 class="text-2xl font-heading font-bold text-foreground mb-2">
            Verificar Código
        </h2>
        <p class="text-muted-foreground">
            Hemos enviado un código de 6 dígitos a <strong>{{ formData().email }}</strong>
        </p>
    </div>
    <form (ngSubmit)="handleCodeSubmit()" class="space-y-4">
        @for (digit of verificationCode; track $index) {
        <input
          #codeInput
          type="text"
          inputmode="numeric"
          maxlength="1"
          [ngModel]="digit"
          [ngModelOptions]="{ standalone: true }"

          class="w-12 h-12 text-center text-lg font-semibold border border-[var(--color-input)] rounded-lg bg-[var(--color-background)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-ring)] focus-visible:ring-offset-2 disabled:opacity-50"
          [disabled]="isLoading()"
        />
      }
    </form>
  </div> -->
  <app-email-verification
    [email]="registrationEmail"
    [pass]="registrationPass"
    purpose="recovery"
    (onVerificationSuccess)="handleVerificationSuccess($event)"
    (onResendCode)="handleResendCode()"
    (onBackToRegistration)="handleBackToRegistration()"
  />
}

<!-- Paso Nueva Contraseña -->
@if (currentStep() === 'newPassword') {
    <div class="space-y-6">
        <div class="text-center">
            <div class="w-16 h-16 bg-success/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <lucide-icon [img]="icons.key" [size]="32" class="text-success"></lucide-icon>
            </div>
            <h2 class="text-2xl font-heading font-bold text-foreground mb-2">
                Nueva Contraseña
            </h2>
            <p class="text-muted-foreground">
                Crea una nueva contraseña segura para tu cuenta
            </p>
        </div>
        <form (ngSubmit)="handlePasswordSubmit()" class="space-y-4">
            <div class="relative">
                <app-input
                    label="Nueva Contraseña"
                    [type]="showPassword() ? 'text' : 'password'"
                    name="newPassword"
                    placeholder="Mínimo 8 caracteres"
                    [value]="formData().newPassword"
                    (valueChange)="handleInputChange('newPassword', $event)"
                    [error]="errors()['newPassword']"
                    [required]="true"
                >
                </app-input>
                <button
                    type="button"
                    (click)="togglePasswordVisibility()"
                    class="absolute right-3 top-9 text-muted-foreground hover:text-foreground transition-colors duration-200 cursor-pointer"
                    >
                    <lucide-icon [img]="showPassword() ? icons.eyeOff : icons.eye" [size]="18"></lucide-icon>
                </button>
            </div>
            <div class="relative">
                <app-input
                    label="Confirmar Contraseña"
                    [type]="showConfirmPassword() ? 'text' : 'password'"
                    name="confirmPassword"
                    placeholder="Repite tu contraseña"
                    [value]="formData().confirmPassword"
                    (valueChange)="handleInputChange('confirmPassword', $event)"
                    [error]="errors()['confirmPassword']"
                    [required]="true"
                >
                </app-input>
                <button
                    type="button"
                    (click)="toggleConfirmPasswordVisibility()"
                    class="absolute right-3 top-9 text-muted-foreground hover:text-foreground transition-colors duration-200 cursor-pointer"
                    >
                    <lucide-icon [img]="showConfirmPassword() ? icons.eyeOff : icons.eye" [size]="18"></lucide-icon>
                </button>
            </div>
            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start space-x-2">
                    <lucide-icon [img]="icons.info" [size]="16" class="text-blue-500 mt-0.5"></lucide-icon>
                    <div class="text-sm text-blue-800">
                        <p class="font-medium mb-1">Consejos para una contraseña segura:</p>
                        <ul class="text-xs space-y-1 text-blue-700">
                            <li>• Al menos 8 caracteres de longitud</li>
                            <li>• Combina letras mayúsculas y minúsculas</li>
                            <li>• Incluye números y símbolos especiales</li>
                            <li>• Evita información personal obvia</li>
                        </ul>
                    </div>
                </div>
            </div>

            <app-button
                type="submit"
                variant="default"
                [loading]="isLoading()"
                iconName="Save"
                iconPosition="left"
                [iconSize]="18"
                [fullWidth]="true"
            >
                <span>{{ isLoading() ? 'Actualizando contraseña...' : 'Actualizar Contraseña' }}</span>
            </app-button>
        </form>
    </div>
}
