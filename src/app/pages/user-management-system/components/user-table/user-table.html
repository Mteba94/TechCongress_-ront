<div class="overflow-x-auto">
    <table class="w-full">
        <thead class="bg-muted/50">
            <tr>
                <th class="px-6 py-3 text-left">
                    <app-checkbox
                        [checked]="allSelected"
                        [indeterminate]="someSelected && !allSelected"
                        (onChange)="selectAll"
                    ></app-checkbox>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('name')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Usuario</span> <lucide-icon [img]="getSortIcon('name')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('role')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Rol</span> <lucide-icon [img]="getSortIcon('role')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('estadoDescripcion')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Estado</span> <lucide-icon [img]="getSortIcon('status')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('institution')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Institución</span> <lucide-icon [img]="getSortIcon('institution')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('activitiesCount')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Actividades</span> <lucide-icon [img]="getSortIcon('activitiesCount')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('registrationDate')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Registro</span> <lucide-icon [img]="getSortIcon('registrationDate')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    <button
                        (click)="onSortClick('lastLogin')"
                        class="flex items-center space-x-1 hover:text-foreground transition-colors duration-200 cursor-pointer"
                    ><span>Último Acceso</span> <lucide-icon [img]="getSortIcon('lastLogin')" [size]="14"></lucide-icon>
                    </button>
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">
                    Acciones
                </th>
            </tr>
        </thead>
        <tbody class="divide-y divide-border">
            <tr *ngFor="let user of users" [attr.data-key]="user?.userId" class="hover:bg-muted/50 transition-colors duration-200">
                <td class="px-6 py-4">
                    <app-checkbox
                        [checked]="selectedUsers.includes(user.userId)"
                        (onChange)="onSelectUserClick(user.userId)"
                    ></app-checkbox>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center">
                            <lucide-icon [img]="icons.user" [size]="20" class="text-primary"></lucide-icon>
                        </div>
                        <div>
                            <div class="font-medium text-foreground">
                                {{user.name}}
                            </div>
                            <div class="text-sm text-muted-foreground">
                                {{user.email}}
                            </div>
                            @if(user.telefono){
                                <div class="text-xs text-muted-foreground">
                                    {{user.telefono}}
                                </div>
                            }
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center space-x-2">
                        <lucide-icon [img]="getRoleIcon(user.role)" [size]="20" class="text-primary"></lucide-icon>
                        <span class="text-sm font-medium text-foreground">{{ getRoleLabel(user.role) }}</span>
                    </div>
                    @if(user.grade){
                        <div class="text-xs text-muted-foreground mt-1">{{ user.grade }} </div>
                    }
                </td>
                <td class="px-6 py-4">
                    <span
                        class="inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium"
                        [ngClass]="{
                            'bg-green-100 text-green-800 ring-green-600/20': getStatusInfo(user.estadoDescripcion).color === 'green',
                            'bg-yellow-100 text-yellow-800 ring-yellow-600/20': getStatusInfo(user.estadoDescripcion).color === 'yellow',
                            'bg-red-100 text-red-800 ring-red-600/20': getStatusInfo(user.estadoDescripcion).color === 'red',
                            'bg-gray-100 text-gray-800 ring-gray-600/20': getStatusInfo(user.estadoDescripcion).color === 'gray'
                        }"
                    >
                        {{ getStatusInfo(user.estadoDescripcion).label }}
                    </span>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-foreground">
                        {{ user.institution }}
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="text-sm font-medium text-foreground">
                                {{ user.activitiesCount }}
                            </div>
                            <div class="text-xs text-muted-foreground">
                                Inscritas
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-medium text-foreground">
                                {{ user.certificatesCount }}
                            </div>
                            <div class="text-xs text-muted-foreground">
                                Certificados
                            </div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-foreground">
                        {{ user.registrationDate | date: 'dd/MM/yyyy' }}
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-foreground">
                        {{ user.lastLogin | date: 'dd/MM/yyyy' }}
                    </div>
                </td>
                <td className="px-6 py-4 text-right">
                    <div class="flex items-center justify-end space-x-2">
                        <app-button
                            variant="ghost"
                            size="sm"
                            (btnClick)="onEditUserClick(user)"
                            iconName="Edit2"
                            [iconSize]="14"
                        >
                            <span>Editar</span>
                        </app-button>
                        <app-button
                            variant="ghost"
                            size="sm"
                            (btnClick)="onViewUserClick(user)"
                            iconName="Eye"
                            [iconSize]="14"
                        >
                            <span>Ver</span>
                        </app-button>
                        <app-button
                            variant="ghost"
                            size="sm"
                            (btnClick)="onDeleteUserClick(user.userId)"
                            iconName="Trash2"
                            [iconSize]="14"
                            class="text-red-600 hover:text-red-700 hover:bg-red-50"
                        >
                            <span>Eliminar</span>
                        </app-button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    @if(users.length === 0 && !loading){
        <div class="text-center py-12">
            <lucide-icon [img]="icons.users" [size]="48" class="text-muted-foreground mx-auto mb-4"></lucide-icon>
            <h3 class="text-lg font-medium text-foreground mb-2">No se encontraron usuarios</h3>
            <p class="text-muted-foreground">Intenta ajustar los filtros de búsqueda</p>
        </div>
    }

    <ng-container *ngIf="loading;">
    <tr *ngFor="let i of [1,2,3,4,5]" class="hover:bg-muted/50 transition-colors duration-200">
      <!-- Checkbox -->
      <td class="px-6 py-4">
        <div class="w-5 h-5 bg-muted/50 rounded"></div>
      </td>

      <!-- Usuario -->
      <td class="px-6 py-4">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-muted/50 rounded-full"></div>
          <div class="space-y-2">
            <div class="w-32 h-4 bg-muted/50 rounded"></div>
            <div class="w-40 h-3 bg-muted/50 rounded"></div>
            <div class="w-24 h-3 bg-muted/50 rounded"></div>
          </div>
        </div>
      </td>

      <!-- Rol -->
      <td class="px-6 py-4">
        <div class="w-28 h-4 bg-muted/50 rounded mb-2"></div>
        <div class="w-20 h-3 bg-muted/50 rounded"></div>
      </td>

      <!-- Estado -->
      <td class="px-6 py-4">
        <div class="inline-flex px-3 py-1 rounded-full bg-muted/50 h-5 w-24"></div>
      </td>

      <!-- Institución -->
      <td class="px-6 py-4">
        <div class="w-40 h-4 bg-muted/50 rounded"></div>
      </td>

      <!-- Actividades -->
      <td class="px-6 py-4">
        <div class="flex items-center space-x-4">
          <div class="text-center">
            <div class="w-10 h-4 bg-muted/50 rounded mx-auto mb-1"></div>
            <div class="w-14 h-3 bg-muted/50 rounded mx-auto"></div>
          </div>
          <div class="text-center">
            <div class="w-10 h-4 bg-muted/50 rounded mx-auto mb-1"></div>
            <div class="w-14 h-3 bg-muted/50 rounded mx-auto"></div>
          </div>
        </div>
      </td>

      <!-- Registro -->
      <td class="px-6 py-4">
        <div class="w-28 h-4 bg-muted/50 rounded"></div>
      </td>

      <!-- Último acceso -->
      <td class="px-6 py-4">
        <div class="w-28 h-4 bg-muted/50 rounded"></div>
      </td>

      <!-- Acciones -->
      <td class="px-6 py-4 text-right">
        <div class="flex justify-end space-x-2">
          <div class="w-8 h-8 bg-muted/50 rounded"></div>
          <div class="w-8 h-8 bg-muted/50 rounded"></div>
          <div class="w-8 h-8 bg-muted/50 rounded"></div>
        </div>
      </td>
    </tr>
  </ng-container>
</div>
