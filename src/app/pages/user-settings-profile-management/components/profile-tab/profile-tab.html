<div class="p-6">
    <div class="flex items-center space-x-3 mb-6">
        <lucide-icon [img]="icons.User" [size]="24" class="text-primary"></lucide-icon>
        <div>
            <h2 class="text-xl font-semibold text-foreground">Gestión de Perfil</h2>
            <p class="text-sm text-muted-foreground">Actualiza tu información personal y foto de perfil</p>
        </div>
    </div>
    <div class="space-y-8">
        <!-- Profile Image Section -->
        <div class="space-y-4">
            <h3 class="text-lg font-medium text-foreground">Foto de Perfil</h3>
            <div class="flex items-center space-x-6">
                <div class="relative">
                    @if (profileData().profileImage) {
                        <img
                            [src]="profileData().profileImage"
                            alt="Profile"
                            class="w-24 h-24 rounded-full object-cover border-4 border-border"
                        />
                    } @else {
                        <div class="w-24 h-24 rounded-full bg-muted border-4 border-border flex items-center justify-center">
                            <lucide-icon [img]="icons.User" [size]="32" class="text-muted-foreground"></lucide-icon>
                        </div>
                    }
                    @if (isUploading()) {
                        <div class="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center">
                            <lucide-icon [img]="icons.Loader" [size]="20" class="animate-spin text-white"></lucide-icon>
                        </div>
                    }
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <input
                            #fileInput
                            type="file"
                            accept="image/*"
                            (change)="handleImageUpload($event)"
                            class="hidden"
                        />
                        <app-button
                            variant="outline"
                            (btnClick)="fileInput.click()"
                            [disabled]="isUploading()"
                            iconName="Upload"
                            iconPosition="left"
                            [iconSize]="16"
                        >
                            @if (isUploading()) {
                                <span>Subiendo...</span>
                            } @else {
                                <span>Subir Foto</span>
                            }
                        </app-button>
                        @if (profileData().profileImage) {
                            <app-button
                                variant="destructive"
                                (btnClick)="removeImage()"
                                [disabled]="isUploading()"
                                iconName="Trash2"
                                iconPosition="left"
                                [iconSize]="16"
                            >
                                Eliminar
                            </app-button>
                        }
                    </div>
                    <p class="text-xs text-muted-foreground">
                        Formato JPG, PNG o GIF. Tamaño máximo 2MB.
                    </p>
                </div>
            </div>
        </div>

        <!-- Personal Information -->
        <div class="space-y-4">
            <h3 class="text-lg font-medium text-foreground">Información Personal</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <app-input
                    label="Nombre Completo"
                    type="text"
                    name="name"
                    placeholder="Tu nombre completo"
                    [value]="profileData().name"
                    (valueChange)="handleInputChange('name', $event)"
                    [required]="true"
                ></app-input>

                <app-input
                    label="Correo Electrónico"
                    type="email"
                    name="email"
                    placeholder="tu@correo.com"
                    [value]="profileData().email"
                    (valueChange)="handleInputChange('email', $event)"
                    [required]="true"
                ></app-input>

                <app-input
                    label="Teléfono"
                    type="tel"
                    name="phone"
                    placeholder="+57 300 123 4567"
                    [value]="profileData().phone"
                    (valueChange)="handleInputChange('phone', $event)"
                ></app-input>

                <app-select
                    label="Institución"
                    placeholder="Selecciona tu institución"
                    [options]="institutionOptions()"
                    [value]="profileData().institution"
                    (valueChange)="handleSelectChange('institution', $event)"
                    [required]="true"
                ></app-select>

                @if (user?.role === 'external') {
                    <app-select
                        label="Grado Académico"
                        placeholder="Selecciona tu grado"
                        [options]="gradeOptions()"
                        [value]="profileData().grade"
                        (valueChange)="handleSelectChange('grade', $event)"
                        [required]="true"
                    ></app-select>
                }
            </div>

            <div class="mt-4">
                <label class="block text-sm font-medium text-foreground mb-2">
                    Biografía
                </label>
                <textarea
                    name="bio"
                    placeholder="Cuéntanos sobre ti, tus intereses y objetivos académicos..."
                    [value]="profileData().bio"
                    (input)="handleInputChange('bio', $event)"
                    rows="4"
                    class="w-full px-3 py-2 border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none text-foreground bg-background"
                ></textarea>
                <p class="text-xs text-muted-foreground mt-1">
                    Máximo 500 caracteres. Esta información será visible en tu perfil público.
                </p>
            </div>
        </div>

        <!-- Validation Warnings -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="flex items-start space-x-2">
                <lucide-icon [img]="icons.AlertTriangle" [size]="16" class="text-yellow-600 mt-0.5"></lucide-icon>
                <div>
                    <h4 class="text-sm font-medium text-yellow-800">Validación de Cambios</h4>
                    <p class="text-sm text-yellow-700 mt-1">
                        Los cambios en tu correo electrónico requerirán verificación. Recibirás un enlace de confirmación.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>