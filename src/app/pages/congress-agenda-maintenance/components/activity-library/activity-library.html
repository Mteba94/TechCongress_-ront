<div class="bg-card border border-border rounded-lg h-fit">
  <div class="p-6 border-b border-border">
    <div class="flex items-center space-x-3 mb-4">
      <lucide-icon [img]="icons.library" [size]="20" class="text-primary"></lucide-icon>
      <h3 class="text-lg font-heading font-semibold text-foreground">
        Biblioteca de Actividades
      </h3>
    </div>

    <!-- Filters -->
    <div class="space-y-4">
      <div class="relative">
        <lucide-icon
          [img]="icons.search"
          [size]="16"
          class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"
        ></lucide-icon>
        <app-input
           placeholder="Buscar actividades..."
           (input)="updateFilter('search', $any($event.target).value)"
           [value]="filters?.search"
           [leadingIcon]="icons.search"
        ></app-input>
      </div>

      <div class="grid grid-cols-2 gap-2">
        <app-select
              label="Categoría"
              [value]="filters?.category"
              (valueChange)="updateFilter('category', $any($event.target).value)"
              [options]="categoryOptions"
          ></app-select>

        <!-- <select
          [value]="filters?.duration"
          (change)="updateFilter('duration', $any($event.target).value)"
        >
          <option value="">Cualquier duración</option>
          <option value="short">≤ 1h</option>
          <option value="medium">1-3h</option>
          <option value="long">> 3h</option>
        </select> -->
      </div>
    </div>
  </div>

  <!-- Activity List -->
  <div class="p-4">
    <div
      cdkDropList
      [cdkDropListData]="activities"
      class="space-y-3"
      id="activity-library"
      [cdkDropListConnectedTo]="['agenda-drop-list']"
    >
      <div *ngIf="loading" class="flex items-center justify-center py-8">
        <lucide-icon [img]="icons.loader" [size]="24" class="animate-spin text-primary"></lucide-icon>
      </div>

      <ng-container *ngIf="!loading && activities && activities.length > 0">
        <div
          *ngFor="let activity of activities; let index = index"
          cdkDrag
          [cdkDragData]="activity"
          class="p-4 bg-background border border-border rounded-lg cursor-grab transition-all duration-200 hover:shadow-md hover:border-primary/50"
        >
          <div class="flex items-start space-x-3">
            <div
              class="p-2 rounded-lg"
              [ngClass]="{
                'bg-blue-100 text-blue-600': activity?.category === 'workshop',
                'bg-yellow-100 text-yellow-600': activity?.category === 'competition',
                'bg-purple-100 text-purple-600': activity?.category === 'conference',
                'bg-green-100 text-green-600': activity?.category === 'social'
              }"
            >
              <lucide-icon [img]="getCategoryIcon(activity?.category)" [size]="16"></lucide-icon>
            </div>

            <div class="flex-1 min-w-0">
              <h4 class="font-medium text-foreground text-sm truncate">
                {{ activity?.title }}
              </h4>
              <p class="text-xs text-muted-foreground mt-1 line-clamp-2">
                {{ activity?.description }}
              </p>

              <div class="flex items-center justify-between mt-3">
                <div class="flex items-center space-x-2">
                  <div class="flex items-center space-x-1">
                    <lucide-icon [img]="icons.clock" [size]="12" class="text-muted-foreground"></lucide-icon>
                    <span class="text-xs text-muted-foreground">
                      <!-- {{ formatDuration(activity.duration) }} -->
                      {{ activity.duration }}
                    </span>
                  </div>
                  <div class="flex items-center space-x-1">
                    <lucide-icon [img]="icons.users" [size]="12" class="text-muted-foreground"></lucide-icon>
                    <span class="text-xs text-muted-foreground">
                      {{ activity.enrolled }} / {{ activity.capacity }}
                    </span>
                  </div>
                </div>

                <lucide-icon [img]="icons.gripVertical" [size]="14" class="text-muted-foreground"></lucide-icon>
              </div>

              <div *ngIf="activity?.instructor" class="flex items-center space-x-1 mt-2">
                <lucide-icon [img]="icons.user" [size]="12" class="text-muted-foreground"></lucide-icon>
                <span class="text-xs text-muted-foreground truncate">
                  {{ activity?.instructor }}
                </span>
              </div>

              <!-- <div *ngIf="activity.requirements && activity.requirements.length > 0" class="flex flex-wrap gap-1 mt-2">
                <ng-container *ngFor="let req of activity.requirements.slice(0, 2); let idx = index">
                  <span
                    class="px-2 py-1 text-xs bg-muted rounded text-muted-foreground"
                  >
                    {{ req }}
                  </span>
                </ng-container>
                <span *ngIf="activity.requirements.length > 2" class="px-2 py-1 text-xs bg-muted rounded text-muted-foreground">
                  +{{ activity.requirements.length - 2 }}
                </span>
              </div> -->
            </div>
          </div>
        </div>
      </ng-container>

      <div *ngIf="!loading && (!activities || activities.length === 0)" class="text-center py-8">
        <lucide-icon [img]="icons.search" [size]="32" class="text-muted-foreground mx-auto mb-2"></lucide-icon>
        <p class="text-muted-foreground text-sm">
          No se encontraron actividades
        </p>
        <button
          (click)="clearFilters()"
          class="mt-2"
        >
          Limpiar filtros
        </button>
      </div>
    </div>

    <div *ngIf="activities && activities.length > 0" class="mt-4 p-3 bg-muted/50 rounded-lg">
      <div class="flex items-center space-x-2 text-sm text-muted-foreground">
        <lucide-icon [img]="icons.info" [size]="14"></lucide-icon>
        <span>
          Arrastra las actividades al calendario para programarlas
        </span>
      </div>
    </div>
  </div>
</div>