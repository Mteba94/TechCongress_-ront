<div 
  *ngIf="isOpen()"
  class="fixed inset-0 z-40 flex items-center justify-center bg-black/60 animate-fade-in"
  (click)="onClose()">

  <div 
    class="relative bg-card text-foreground rounded-lg shadow-xl w-full max-w-2xl m-4 animate-scale-in flex flex-col max-h-[80vh]"
    (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="flex items-start justify-between p-5 border-b border-border rounded-t-lg">
      <div class="flex items-center space-x-3">
        <lucide-icon [img]="icons.users" [size]="20" class="text-primary"></lucide-icon>
        <div>
            <h3 class="text-lg font-semibold leading-6">
              Participantes Inscritos
            </h3>
            <p class="text-sm text-muted-foreground">{{ activityTitle() }}</p>
        </div>
      </div>
      <button 
        type="button" 
        class="p-1 text-muted-foreground rounded-full hover:bg-muted cursor-pointer"
        (click)="onClose()">
        <lucide-icon [img]="icons.x" [size]="20"></lucide-icon>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6 overflow-y-auto">
      @if (loading()) {
        <!-- Loading Skeleton -->
        <div class="space-y-2">
          @for (item of [1,2,3,4,5]; track $index) {
            <div class="flex items-center justify-between p-3 rounded-lg bg-muted/50 animate-pulse">
              <div class="h-4 bg-muted rounded w-1/3"></div>
              <div class="h-4 bg-muted rounded w-1/4"></div>
              <div class="h-4 bg-muted rounded w-1/6"></div>
            </div>
          }
        </div>
      } @else if (participants().length === 0) {
        <!-- Empty State -->
        <div class="text-center py-10">
          <lucide-icon [img]="icons.users" [size]="48" class="text-muted-foreground mx-auto mb-4"></lucide-icon>
          <h4 class="text-lg font-semibold">No hay participantes</h4>
          <p class="text-sm text-muted-foreground">AÃºn no hay nadie inscrito en esta actividad.</p>
        </div>
      } @else {
        <!-- Participants Table -->
        <div class="border border-border rounded-lg">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-border">
                <thead class="bg-muted/50">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Nombre</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Email</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Puntaje</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">Ganador</th>
                  </tr>
                </thead>
                <tbody class="bg-card divide-y divide-border">
                  @for (participant of participants(); track participant.userId) {
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-foreground">{{ participant.userName }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">{{ participant.userEmail }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">{{ participant.puntaje }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm">
                        @if (participant.esGanador) {
                            <lucide-icon [img]="icons.award" [size]="18" class="text-yellow-500"></lucide-icon>
                        } @else {
                            <span>-</span>
                        }
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
      }
    </div>
  </div>
</div>
